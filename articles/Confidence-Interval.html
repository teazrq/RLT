<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Confidence Interval Estimation â€¢ RLT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Confidence Interval Estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RLT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Test-RLT.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/Test-Reg.html">Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Cla.html">Classification</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Surv.html">Survival</a></li>
    <li><a class="dropdown-item" href="../articles/Variable-Importance.html">Variable Importance</a></li>
    <li><a class="dropdown-item" href="../articles/Confidence-Interval.html">Confidence Interval Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial_rl.html">Reinforcement Learning Splitting Rule</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../DEVELOPING.html">Developing</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/teazrq/RLT" aria-label="GitHub"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Confidence Interval Estimation</h1>
            
      

      <div class="d-none name"><code>Confidence-Interval.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Confidence interval estimation is essential for understanding the
uncertainty in random forest predictions. The RLT package provides
comprehensive tools for estimating confidence intervals across different
types of models, including regression, classification, and survival
analysis.</p>
</div>
<div class="section level2">
<h2 id="variance-estimation-for-regression">Variance Estimation for Regression<a class="anchor" aria-label="anchor" href="#variance-estimation-for-regression"></a>
</h2>
<p>For regression models, RLT can estimate prediction variance and
construct confidence intervals using the out-of-bag samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=RLT" class="external-link">RLT</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; RLT and Random Forests v4.2.6</span></span>
<span><span class="co">#&gt; pre-release at github.com/teazrq/RLT</span></span>
<span></span>
<span><span class="co"># Generate regression data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">trainn</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="va">testn</span> <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="va">trainn</span> <span class="op">+</span> <span class="va">testn</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># Generate features</span></span>
<span><span class="va">X1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="op">(</span><span class="va">p</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">p</span><span class="op">)</span> <span class="va">X</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate response</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split data</span></span>
<span><span class="va">trainX</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">trainn</span>, <span class="op">]</span></span>
<span><span class="va">trainY</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">trainn</span><span class="op">]</span></span>
<span><span class="va">testX</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="op">(</span><span class="va">trainn</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n</span>, <span class="op">]</span></span>
<span><span class="va">testY</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="op">(</span><span class="va">trainn</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Order test data for visualization</span></span>
<span><span class="va">xorder</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">testX</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">testX</span> <span class="op">=</span> <span class="va">testX</span><span class="op">[</span><span class="va">xorder</span>, <span class="op">]</span></span>
<span><span class="va">testY</span> <span class="op">=</span> <span class="va">testY</span><span class="op">[</span><span class="va">xorder</span><span class="op">]</span></span></code></pre></div>
<div class="section level3">
<h3 id="regression-confidence-intervals">Regression Confidence Intervals<a class="anchor" aria-label="anchor" href="#regression-confidence-intervals"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit RLT model with variance estimation</span></span>
<span><span class="va">RLTfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RLT.html">RLT</a></span><span class="op">(</span><span class="va">trainX</span>, <span class="va">trainY</span>, model <span class="op">=</span> <span class="st">"regression"</span>, </span>
<span>              ntrees <span class="op">=</span> <span class="fl">2000</span>, mtry <span class="op">=</span> <span class="va">p</span>, nmin <span class="op">=</span> <span class="fl">40</span>, </span>
<span>              split.gen <span class="op">=</span> <span class="st">"best"</span>, resample.prob <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>              param.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"var.ready"</span> <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                   <span class="st">"resample.track"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in RLT(trainX, trainY, model = "regression", ntrees = 2000, mtry = p, : resample.replace is set to FALSE due to var.ready</span></span>
<span><span class="co">#&gt; Regression Random Forest ... </span></span>
<span><span class="co">#&gt; ---------- Parameters Summary ----------</span></span>
<span><span class="co">#&gt;               (N, P) = (1000, 20)</span></span>
<span><span class="co">#&gt;           # of trees = 2000</span></span>
<span><span class="co">#&gt;         (mtry, nmin) = (20, 40)</span></span>
<span><span class="co">#&gt;       split generate = Best</span></span>
<span><span class="co">#&gt;             sampling = 0.5 w/o replace</span></span>
<span><span class="co">#&gt;   (Obs, Var) weights = (No, No)</span></span>
<span><span class="co">#&gt;           importance = none</span></span>
<span><span class="co">#&gt;        reinforcement = No</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span></span>
<span><span class="co"># Predict with variance estimation</span></span>
<span><span class="va">RLTPred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">RLTfit</span>, <span class="va">testX</span>, var.est <span class="op">=</span> <span class="cn">TRUE</span>, keep.all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate confidence intervals</span></span>
<span><span class="va">upper</span> <span class="op">=</span> <span class="va">RLTPred</span><span class="op">$</span><span class="va">Prediction</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">RLTPred</span><span class="op">$</span><span class="va">Variance</span><span class="op">)</span></span>
<span><span class="va">lower</span> <span class="op">=</span> <span class="va">RLTPred</span><span class="op">$</span><span class="va">Prediction</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">RLTPred</span><span class="op">$</span><span class="va">Variance</span><span class="op">)</span></span>
<span><span class="va">cover</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">testX</span><span class="op">$</span><span class="va">X1</span> <span class="op">&gt;</span> <span class="va">lower</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">testX</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;</span> <span class="va">upper</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">testX</span><span class="op">$</span><span class="va">X1</span>, <span class="va">RLTPred</span><span class="op">$</span><span class="va">Prediction</span>, pch <span class="op">=</span> <span class="fl">19</span>, </span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cover</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cover</span>, <span class="st">"green"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Truth"</span>, ylab <span class="op">=</span> <span class="st">"Predicted"</span>, </span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Regression Confidence Intervals"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"darkorange"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add confidence intervals</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">testn</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">+</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>           col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cover</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cover</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"green"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"covered"</span>, <span class="st">"not covered"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"black"</span><span class="op">)</span>, </span>
<span>       lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Confidence-Interval_files/figure-html/regression-ci-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="variance-estimation-for-classification">Variance Estimation for Classification<a class="anchor" aria-label="anchor" href="#variance-estimation-for-classification"></a>
</h2>
<p>For classification models, RLT can estimate variance for class
probabilities and construct confidence intervals.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate classification data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">trainn</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">testn</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">trainn</span> <span class="op">+</span> <span class="va">testn</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># Generate features</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">[</span>, <span class="op">(</span><span class="va">p</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="op">(</span><span class="va">p</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">p</span><span class="op">]</span>, <span class="va">as.factor</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate outcomes</span></span>
<span><span class="va">logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu">logit</span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split data</span></span>
<span><span class="va">trainX</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">trainn</span>, <span class="op">]</span></span>
<span><span class="va">trainY</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">trainn</span><span class="op">]</span></span>
<span><span class="va">testX</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="op">(</span><span class="va">trainn</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n</span>, <span class="op">]</span></span>
<span><span class="va">testY</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="op">(</span><span class="va">trainn</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Order test data</span></span>
<span><span class="va">xorder</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">testX</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">testX</span> <span class="op">=</span> <span class="va">testX</span><span class="op">[</span><span class="va">xorder</span>, <span class="op">]</span></span>
<span><span class="va">testY</span> <span class="op">=</span> <span class="va">testY</span><span class="op">[</span><span class="va">xorder</span><span class="op">]</span></span>
<span><span class="va">testprob</span> <span class="op">=</span> <span class="fu">logit</span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="classification-confidence-intervals">Classification Confidence Intervals<a class="anchor" aria-label="anchor" href="#classification-confidence-intervals"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit classification model with variance estimation</span></span>
<span><span class="va">RLTfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RLT.html">RLT</a></span><span class="op">(</span><span class="va">trainX</span>, <span class="va">trainY</span>, model <span class="op">=</span> <span class="st">"classification"</span>, </span>
<span>              ntrees <span class="op">=</span> <span class="fl">2000</span>, mtry <span class="op">=</span> <span class="va">p</span>, nmin <span class="op">=</span> <span class="fl">20</span>, </span>
<span>              split.gen <span class="op">=</span> <span class="st">"random"</span>, resample.prob <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>              param.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"var.ready"</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="st">"resample.track"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in RLT(trainX, trainY, model = "classification", ntrees = 2000, : resample.replace is set to FALSE due to var.ready</span></span>
<span><span class="co">#&gt; Classification Random Forest ... </span></span>
<span><span class="co">#&gt; ---------- Parameters Summary ----------</span></span>
<span><span class="co">#&gt;               (N, P) = (1000, 20)</span></span>
<span><span class="co">#&gt;           # of trees = 2000</span></span>
<span><span class="co">#&gt;         (mtry, nmin) = (20, 20)</span></span>
<span><span class="co">#&gt;       split generate = Random, 1</span></span>
<span><span class="co">#&gt;             sampling = 0.5 w/o replace</span></span>
<span><span class="co">#&gt;   (Obs, Var) weights = (No, No)</span></span>
<span><span class="co">#&gt;           importance = none</span></span>
<span><span class="co">#&gt;        reinforcement = No</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span></span>
<span><span class="co"># Predict with variance estimation</span></span>
<span><span class="va">RLTPred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">RLTfit</span>, <span class="va">testX</span>, var.est <span class="op">=</span> <span class="cn">TRUE</span>, keep.all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate confidence intervals for P(Y = 1)</span></span>
<span><span class="va">upper</span> <span class="op">=</span> <span class="va">RLTPred</span><span class="op">$</span><span class="va">Prob</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">RLTPred</span><span class="op">$</span><span class="va">Variance</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in sqrt(RLTPred$Variance[, 2]): NaNs produced</span></span>
<span><span class="va">lower</span> <span class="op">=</span> <span class="va">RLTPred</span><span class="op">$</span><span class="va">Prob</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">RLTPred</span><span class="op">$</span><span class="va">Variance</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in sqrt(RLTPred$Variance[, 2]): NaNs produced</span></span>
<span><span class="va">cover</span> <span class="op">=</span> <span class="op">(</span><span class="va">testprob</span> <span class="op">&gt;</span> <span class="va">lower</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">testprob</span> <span class="op">&lt;</span> <span class="va">upper</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span>, <span class="va">RLTPred</span><span class="op">$</span><span class="va">Prob</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, </span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cover</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cover</span>, <span class="st">"green"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"X1"</span>, ylab <span class="op">=</span> <span class="st">"P(Y = 1)"</span>, </span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">RLTPred</span><span class="op">$</span><span class="va">Prob</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">RLTPred</span><span class="op">$</span><span class="va">Prob</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Classification Confidence Intervals"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span>, <span class="va">testprob</span>, col <span class="op">=</span> <span class="st">"darkorange"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add confidence intervals</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">testn</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="va">testX</span><span class="op">$</span><span class="va">X1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">testX</span><span class="op">$</span><span class="va">X1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>           col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cover</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cover</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"green"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"covered"</span>, <span class="st">"not covered"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"black"</span><span class="op">)</span>, </span>
<span>       lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Confidence-Interval_files/figure-html/classification-ci-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="survival-analysis-confidence-bands">Survival Analysis Confidence Bands<a class="anchor" aria-label="anchor" href="#survival-analysis-confidence-bands"></a>
</h2>
<p>For survival analysis, RLT provides sophisticated methods for
constructing confidence bands around survival curves.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate survival data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create survival times</span></span>
<span><span class="va">xlink</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">FT</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="fu">xlink</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CT</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">FT</span>, <span class="va">CT</span><span class="op">)</span></span>
<span><span class="va">Censor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">FT</span> <span class="op">&lt;=</span> <span class="va">CT</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate test data</span></span>
<span><span class="va">ntest</span> <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="va">testx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">ntest</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, <span class="va">ntest</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate true survival function</span></span>
<span><span class="va">timepoints</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span><span class="va">Censor</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SurvMat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">testx</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">timepoints</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">exprate</span> <span class="op">=</span> <span class="fu">xlink</span><span class="op">(</span><span class="va">testx</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">timepoints</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">SurvMat</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">pexp</a></span><span class="op">(</span><span class="va">timepoints</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, rate <span class="op">=</span> <span class="va">exprate</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="survival-model-fitting">Survival Model Fitting<a class="anchor" aria-label="anchor" href="#survival-model-fitting"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit survival model</span></span>
<span><span class="va">RLTfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RLT.html">RLT</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, <span class="va">Censor</span>, model <span class="op">=</span> <span class="st">"survival"</span>, </span>
<span>              ntrees <span class="op">=</span> <span class="fl">2000</span>, nmin <span class="op">=</span> <span class="fl">20</span>, mtry <span class="op">=</span> <span class="fl">20</span>, split.gen <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>              resample.prob <span class="op">=</span> <span class="fl">0.5</span>, resample.replace <span class="op">=</span> <span class="cn">FALSE</span>, nsplit <span class="op">=</span> <span class="fl">5</span>,</span>
<span>              param.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>split.rule <span class="op">=</span> <span class="st">"logrank"</span>, <span class="st">"var.ready"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>              importance <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, ncores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Survival Forest... </span></span>
<span><span class="co">#&gt; ---------- Parameters Summary ----------</span></span>
<span><span class="co">#&gt;               (N, P) = (600, 20)</span></span>
<span><span class="co">#&gt;           # of trees = 2000</span></span>
<span><span class="co">#&gt;         (mtry, nmin) = (20, 20)</span></span>
<span><span class="co">#&gt;       split generate = Random, 5</span></span>
<span><span class="co">#&gt;             sampling = 0.5 w/o replace</span></span>
<span><span class="co">#&gt;   (Obs, Var) weights = (No, No)</span></span>
<span><span class="co">#&gt;           importance = none</span></span>
<span><span class="co">#&gt;        reinforcement = No</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span></span>
<span><span class="co"># Predict with variance estimation</span></span>
<span><span class="va">RLTPred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">RLTfit</span>, <span class="va">testx</span>, ncores <span class="op">=</span> <span class="fl">1</span>, var.est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="confidence-band-methods">Confidence Band Methods<a class="anchor" aria-label="anchor" href="#confidence-band-methods"></a>
</h3>
<p>RLT provides several approaches for constructing confidence
bands:</p>
<div class="section level4">
<h4 id="naive-monte-carlo-approach">1. Naive Monte Carlo Approach<a class="anchor" aria-label="anchor" href="#naive-monte-carlo-approach"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span></span>
<span></span>
<span><span class="co"># Original Monte Carlo approach without smoothing</span></span>
<span><span class="va">SurvBand</span> <span class="op">=</span> <span class="fu"><a href="../reference/get.surv.band.html">get.surv.band</a></span><span class="op">(</span><span class="va">RLTPred</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, approach <span class="op">=</span> <span class="st">"eigen-th-mc"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot results for first few subjects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">timepoints</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">6</span>, <span class="va">ntest</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Truth</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvMat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>       ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subject"</span>, <span class="va">i</span><span class="op">)</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subject"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Estimated survival</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">RLTPred</span><span class="op">$</span><span class="va">Survival</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Naive confidence bands</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvBand</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvBand</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Confidence-Interval_files/figure-html/naive-mc-1.png" width="1152"></p>
</div>
<div class="section level4">
<h4 id="smoothed-monte-carlo-approach">2. Smoothed Monte Carlo Approach<a class="anchor" aria-label="anchor" href="#smoothed-monte-carlo-approach"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Monte Carlo approach using smoothed rescaled covariance matrix</span></span>
<span><span class="va">SurvBand</span> <span class="op">=</span> <span class="fu"><a href="../reference/get.surv.band.html">get.surv.band</a></span><span class="op">(</span><span class="va">RLTPred</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, approach <span class="op">=</span> <span class="st">"smoothed-mc"</span>, nsim <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: no DISPLAY variable so Tk is not available</span></span>
<span><span class="co">#&gt; Warning in rgl.init(initValue, onlyNULL): RGL: unable to open X11 display</span></span>
<span><span class="co">#&gt; Warning: 'rgl.init' failed, will use the null device.</span></span>
<span><span class="co">#&gt; See '?rgl.useNULL' for ways to avoid this warning.</span></span>
<span></span>
<span><span class="co"># Plot results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">timepoints</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">6</span>, <span class="va">ntest</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Truth</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvMat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>       ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subject"</span>, <span class="va">i</span><span class="op">)</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subject"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Estimated survival</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">RLTPred</span><span class="op">$</span><span class="va">Survival</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Smoothed confidence bands</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvBand</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvBand</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Confidence-Interval_files/figure-html/smoothed-mc-1.png" width="1152"></p>
</div>
<div class="section level4">
<h4 id="smoothed-low-rank-monte-carlo">3. Smoothed Low-rank Monte Carlo<a class="anchor" aria-label="anchor" href="#smoothed-low-rank-monte-carlo"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Low rank smoothed approach with adaptive Bonferroni critical value</span></span>
<span><span class="va">SurvBand</span> <span class="op">=</span> <span class="fu"><a href="../reference/get.surv.band.html">get.surv.band</a></span><span class="op">(</span><span class="va">RLTPred</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, approach <span class="op">=</span> <span class="st">"smoothed-lr"</span>, r <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">timepoints</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">6</span>, <span class="va">ntest</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Truth</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvMat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>       ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subject"</span>, <span class="va">i</span><span class="op">)</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subject"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Estimated survival</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">RLTPred</span><span class="op">$</span><span class="va">Survival</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Low-rank confidence bands</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvBand</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">logt</span>, <span class="va">SurvBand</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Confidence-Interval_files/figure-html/smoothed-lr-1.png" width="1152"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Report average approximation error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Average approximation error:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">SurvBand</span>, <span class="st">"[["</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average approximation error: 0.0906328215138488</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="covariance-matrix-visualization">Covariance Matrix Visualization<a class="anchor" aria-label="anchor" href="#covariance-matrix-visualization"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize covariance matrices</span></span>
<span><span class="va">i</span> <span class="op">=</span> <span class="fl">5</span>  <span class="co"># Choose a subject</span></span>
<span><span class="va">ccov</span> <span class="op">=</span> <span class="va">RLTPred</span><span class="op">$</span><span class="va">Cov</span><span class="op">[</span>,,<span class="va">i</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Original covariance matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">ccov</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ccov</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>, Rowv <span class="op">=</span> <span class="cn">NA</span>, Colv <span class="op">=</span> <span class="cn">NA</span>, symm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Original Covariance Matrix"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Confidence-Interval_files/figure-html/covariance-viz-1.png" width="768"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Note: The smoothed covariance approximation code is used internally</span></span>
<span><span class="co"># in the get.surv.band function for better numerical stability</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="key-points">Key Points<a class="anchor" aria-label="anchor" href="#key-points"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Regression</strong>: Variance estimation provides confidence
intervals for continuous predictions</li>
<li>
<strong>Classification</strong>: Variance estimation provides
confidence intervals for class probabilities</li>
<li>
<strong>Survival</strong>: Multiple approaches for confidence bands
around survival curves</li>
<li>
<strong>Methods</strong>:
<ul>
<li>Naive Monte Carlo: Simple but may be computationally intensive</li>
<li>Smoothed Monte Carlo: Uses smoothed covariance for better numerical
stability</li>
<li>Low-rank Monte Carlo: Efficient approach with adaptive critical
values</li>
</ul>
</li>
<li>
<strong>Coverage</strong>: Confidence intervals should cover the
true values with the specified confidence level</li>
</ol>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The RLT package provides comprehensive tools for confidence interval
estimation across different types of models. The choice of method
depends on the model type and computational requirements. For survival
analysis, the smoothed approaches generally provide better numerical
stability and computational efficiency.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ruoqing Zhu, Sarah Formentini.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
